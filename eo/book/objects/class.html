<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Klaso - Ymir Tour</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        
        <link rel="stylesheet" href="custom.css">
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="README.html"><strong>1.</strong> Antaŭparolo</a></li><li><a href="hello-world/README.html"><strong>2.</strong> Bonan tagon mondo</a></li><li><ul class="section"><li><a href="hello-world/commentaires.html"><strong>2.1.</strong> Komentoj</a></li></ul></li><li><a href="primitives/README.html"><strong>3.</strong> Bazaj konceptoj de programado</a></li><li><ul class="section"><li><a href="primitives/variables.html"><strong>3.1.</strong> Variabloj kaj Ŝanĝebleco</a></li><li><a href="primitives/types.html"><strong>3.2.</strong> Datenaj tipoj</a></li><li><a href="primitives/functions.html"><strong>3.3.</strong> Funkcioj</a></li><li><a href="primitives/control.html"><strong>3.4.</strong> Kontrolaj fluoj</a></li><li><a href="primitives/operator.html"><strong>3.5.</strong> Prioritato de operacioj</a></li></ul></li><li><a href="advanced/README.html"><strong>4.</strong> Alnomoj, Referencoj kaj pureco</a></li><li><ul class="section"><li><a href="advanced/references.html"><strong>4.1.</strong> Referencoj</a></li><li><a href="advanced/alias.html"><strong>4.2.</strong> Alnomoj</a></li><li><a href="advanced/copies.html"><strong>4.3.</strong> Kopio kaj profunda kopio</a></li><li><a href="advanced/best.html"><strong>4.4.</strong> Plej bonaj kutimoj</a></li><li><a href="advanced/pure.html"><strong>4.5.</strong> Puraj valoroj</a></li></ul></li><li><a href="modules/README.html"><strong>5.</strong> Pakaĵoj</a></li><li><a href="types/README.html"><strong>6.</strong> Tipoj difinitaj de la uzanto</a></li><li><ul class="section"><li><a href="types/struct.html"><strong>6.1.</strong> Strukturo</a></li><li><a href="types/enum.html"><strong>6.2.</strong> Enumeracio</a></li><li><a href="types/aka.html"><strong>6.3.</strong> Kaŝnomo</a></li></ul></li><li><a href="objects/README.html"><strong>7.</strong> Objektoj</a></li><li><ul class="section"><li><a href="objects/class.html" class="active"><strong>7.1.</strong> Klaso</a></li><li><a href="objects/mutability.html"><strong>7.2.</strong> Ŝanĝebleco</a></li><li><a href="objects/methods.html"><strong>7.3.</strong> Metodoj</a></li><li><a href="objects/inheritance.html"><strong>7.4.</strong> Heredeco</a></li><li><a href="objects/traits.html"><strong>7.5.</strong> Trajto</a></li><li><a href="objects/cast.html"><strong>7.6.</strong> Tipŝanĝo, kaj dinamikaj tipoj</a></li></ul></li><li><a href="functions/README.html"><strong>8.</strong> Funkcioj pli kompleksaj</a></li><li><a href="pattern/README.html"><strong>9.</strong> Skema kongruo</a></li><li><a href="errors/main.html"><strong>10.</strong> Traktado de Eraroj</a></li><li><ul class="section"><li><a href="errors/scope_guards.html"><strong>10.1.</strong> Regionaj gardantoj</a></li><li><a href="errors/catching.html"><strong>10.2.</strong> Kapti erarojn</a></li><li><a href="errors/option.html"><strong>10.3.</strong> Esceptoj kaj opcia tipo</a></li><li><a href="errors/fptr_closure.html"><strong>10.4.</strong> Montrilo de Malsekuraj Funkcioj</a></li></ul></li><li><a href="templates/README.html"><strong>11.</strong> Ŝablonoj</a></li><li><ul class="section"><li><a href="templates/special.html"><strong>11.1.</strong> Ŝablonaj tipoj</a></li><li><a href="templates/cte.html"><strong>11.2.</strong> Ŝablonaj valoroj</a></li><li><a href="templates/values.html"><strong>11.3.</strong> Plenumo dum kompilado</a></li></ul></li><li><a href="objects/common_traits.html"><strong>12.</strong> Ordinaraj trajtoj</a></li><li><ul class="section"><li><a href="traits/streamable.html"><strong>12.1.</strong> &quot;Streamable&quot;</a></li><li><a href="traits/copiable.html"><strong>12.2.</strong> &quot;Copiable&quot;</a></li><li><a href="traits/disposable.html"><strong>12.3.</strong> &quot;With&quot; gardanto kaj &quot;Disposable&quot;</a></li><li><a href="traits/hashable.html"><strong>12.4.</strong> &quot;Hashable&quot;</a></li><li><a href="traits/serialize.html"><strong>12.5.</strong> &quot;Packable&quot; kaj &quot;Serializable&quot;</a></li></ul></li><li><a href="templates/operators.html"><strong>13.</strong> Transŝargo de Operacisimboloj</a></li><li><ul class="section"><li><a href="templates/binary.html"><strong>13.1.</strong> Unuopaj, duopaj kaj komparaj operacioj</a></li><li><a href="templates/complex_operators.html"><strong>13.2.</strong> Aliraj, Enhavaj kaj iteraciaj operacioj</a></li></ul></li><li><a href="version/README.html"><strong>14.</strong> Versioj</a></li><li><a href="macros/README.html"><strong>15.</strong> Makrooj</a></li><li><ul class="section"><li><a href="macros/std.html"><strong>15.1.</strong> Normaj kaj kernaj makrooj</a></li></ul></li><li><a href="documentation/README.html"><strong>16.</strong> Dokumentaro</a></li><li><ul class="section"><li><a href="documentation/types.html"><strong>16.1.</strong> Tipoj</a></li><li><a href="documentation/symbols.html"><strong>16.2.</strong> Simboloj</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Ymir Tour</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="objects/class.html#class" id="class"><h1>Class</h1></a>
<p>An object is an instance of a class. A class is declared using the
keyword <strong><code>class</code></strong>, followed by the identifier of the class.  The
complete grammar of a class definition is presented in the following
code block.</p>
<pre><code class="language-grammar">class_decl := simple_class_decl | template_class_decl

simple_class_decl := 'class' (modifiers)? Identifier ('over' type)? '{' class_content '}'
template_class_decl := 'class' ('if' expression)? (modifiers)? Identifier templates ('over' type)? '{' class_content '}'
class_content :=   field
                 | method
                 | constructor
                 | impl
                 | destructor
modifiers := '@' ('{' modifier (',' modifier)* '}') | (modifier)
modifier := 'final' | 'abstract'
</code></pre>
<p><br></p>
<p>As many symbols, the class can be a template symbols. Templates are
not presented in this chapter, and are left for a future chapter
(<em>cf.</em>
<a href="https://gnu-ymir.github.io/Documentations/en/templates/">Templates</a>).</p>
<a class="header" href="objects/class.html#fields" id="fields"><h2>Fields</h2></a>
<p>A class can contain fields. A field is declared as a variable, using
the keyword <code>let</code>. A field can have a default value, in that case the
type is optional, however if the value is not set, the field must have
a type. Multiple fields can be declared within the same <strong><code>let</code></strong>,
with coma separating them.</p>
<pre><code class="language-ymir">class Point4D {
    let _x : i32;
    let _y = 0;
    let _z : i32, _w = 0;
}
</code></pre>
<a class="header" href="objects/class.html#field-privacy" id="field-privacy"><h3>Field privacy</h3></a>
<p>All fields are protected by default, i.e. only the class defining them
and its heirs have access to them. The keyword <strong><code>pub</code></strong> can be used
to make the fields public, and accessible from outside the class
definition. The keyword <strong><code>prv</code></strong>, on the other hand, can be use to
make the field totally hidden from outside the class. Unlike
<strong><code>prot</code></strong>, <strong><code>prv</code></strong> fields are not accessible by the heirs of a
class.</p>
<p>A good practice is to enclose the privacy of the fields in their name
definition. For example, a public field is named <strong><code>x</code></strong>, without any
<strong><code>_</code></strong> token. A protected fields always starts with a single
underscore, <strong><code>_y</code></strong>, and private fields are surrounded by two
underscores before and after the identifier. This is just a convention,
the name has no impact on the privacy.</p>
<pre><code class="language-ymir">class A {
    pub  let x = 12;
    prot let _y : i32;
    prv  let __z__ : i32;
}
</code></pre>
<a class="header" href="objects/class.html#constructor" id="constructor"><h2>Constructor</h2></a>
<p>To be instancible, a class must declare at least one constructor. The
constructor is always named <code>self</code>, and takes parameters to build the
object. The object is accessible within the constructor body through
the variable <strong><code>self</code></strong>.</p>
<a class="header" href="objects/class.html#field-construction" id="field-construction"><h3>Field construction</h3></a>
<p>The constructor must set the value to all the fields of the
class, with the keyword <strong><code>with</code></strong>. Fields with default values are not
necessarily set by this <strong><code>with</code></strong> statement, but can be
redefined. The with statement has the effect of the initial value of
the fields, meaning that the value of immutable fields is set by them.</p>
<pre><code class="language-ymir">class Point {
    let _x : i32;
    let _y = 0;
    
    /**
     * _y is already initialized
     * it is not mandatory to add it in the with initialization
     */
    pub self () with _x = 12 {}
    
    /**
     * But it can be redefined
     */
    pub self (x : i32, y : i32) with _x = x, _y = y {}
}
</code></pre>
<p><br></p>
<p>Field value is set only once. For example, if a class has a field
<strong><code>_x</code></strong> with a default value, calling a function <strong><code>foo</code></strong>. And the
constructor use the <strong><code>with</code></strong> statement to set the value of the field
from the return value of the <strong><code>bar</code></strong> function, the function
<strong><code>foo</code></strong> is never called.</p>
<pre><code class="language-ymir">def foo () -&gt; i32 {
    println (&quot;Foo&quot;);
    42
}

def bar () -&gt; i32 {
    println (&quot;bar&quot;)
    33
}

class A {
    let _x = foo ();
    
    pub self () with _x = bar () {} // foo is not called, bar is call instead
}
</code></pre>
<p><br></p>
<p>The point behind <strong><code>with</code></strong> field construction, is to ensure that all
fields have a value, when entering the constructor body. This way,
when instruction are made inside the constructor body, such as
printing the value of the fields, their value is already set, and the
object instance is already valid.</p>
<pre><code class="language-ymir">class A {
    let _x : i32;
    
    pub self () with _x = 42 {
        println (self._x); // access the field _x, of the current object instance
    } 
}
</code></pre>
<a class="header" href="objects/class.html#create-an-object-instance" id="create-an-object-instance"><h3>Create an object instance</h3></a>
<p>Class are used to create object instance, by calling a
constructor. This call is made using the double colon binary operator
<strong><code>::</code></strong>, with the left operand being the name of the class to
instantiate, and the right operand the keyword <strong><code>new</code></strong>. After the
keyword <strong><code>new</code></strong> a list of argument is presented, this list is the
list of argument to pass to the constructor. The constructor with the
best affinity is choosed and called on a allocated instance of the
class. Constructor affinity is computed as function affinity (based on
type mutability, and type compatibility – <em>cf.</em> <a href="https://gnu-ymir.github.io/Documentations/en/advanced/">Aliases and
References</a>).</p>
<pre><code class="language-ymir">import std::io

class A {

    pub self (x : i32) {
        println (&quot;Int : &quot;, x);
    }
    
    pub self (x : f32) {
        println (&quot;Float : &quot;, x);
    }

}

def main () {
    let _ = A::new (12);
    let _ = A::new (12.f);
}
</code></pre>
<p><br>
Results</p>
<pre><code>Int : 12
Float : 12.000000
</code></pre>
<a class="header" href="objects/class.html#named-constructor" id="named-constructor"><h3>Named constructor</h3></a>
<p>A name can be added to the constructor. This name is an Identifier,
and follows the keyword <strong><code>self</code></strong>. A named constructor can be called
by its name when constructing a class. This way two constructor can
share the same prototype, and be called from their name. A named
constructor is <strong>not</strong> ignored when constructing a class with the
<strong><code>new</code></strong> keyword, its named is just not considered.</p>
<p>In the following example, a class <strong><code>A</code></strong> contains two constructors,
<strong><code>foo</code></strong> and <strong><code>bar</code></strong>, these constructors have one parameter of type
<strong><code>i32</code></strong>.</p>
<pre><code class="language-ymir">import std::io

class A {
    let _x : i32;
    
    pub self foo (x : i32) with _x = x {
        println (&quot;Foo &quot;, self._x);
    }
    
    pub self bar (x : i32) with _x = x {
        println (&quot;Bar &quot;, self._x);
    }
}

def main () {
    let _ = A::foo (12);
    let _ = A::bar (12); 
    
    let _ = A::new (12);
}
</code></pre>
<p><br></p>
<p>The last object construction at line <strong>19</strong> is not possible, the call
working with both <strong><code>foo</code></strong> and <strong><code>bar</code></strong>. The other constructions
work fine, that is why the compiler returns only the following error.</p>
<pre><code class="language-error">Error : {self foo (x : i32)-&gt; mut &amp;(mut main::A), self bar (x : i32)-&gt; mut &amp;(mut main::A)} x 2 called with {i32} work with both
 --&gt; main.yr:(19,17)
19  ┃ 	let _ = A::new (12);
    ╋ 	               ^
    ┃ Note : candidate self --&gt; main.yr:(6,6) : self foo (x : i32)-&gt; mut &amp;(mut main::A)
    ┃ Note : candidate self --&gt; main.yr:(10,6) : self bar (x : i32)-&gt; mut &amp;(mut main::A)
    ┗━━━━━━ 


ymir1: fatal error: 
compilation terminated.
</code></pre>
<a class="header" href="objects/class.html#construction-redirection" id="construction-redirection"><h3>Construction redirection</h3></a>
<p>To avoid redondent code, a constructor can call another constructor in
the <strong><code>with</code></strong> statement. This call redirection is performed by using
the <strong><code>self</code></strong> keyword. In that case, because the fields are already
constructed by the called constructor, they must not be reconstructed.</p>
<pre><code class="language-ymir">import std::io;

class A {
    let _x : i32;

    pub self () with self (12) {
        println (&quot;Scd &quot;, self._x);
    }

    pub self (x : i32) with _x = x {
        println (&quot;Fst &quot;, self._x);
    }
    
}


def main () {
    let _ = A::new (); // construct an instance of the class A
                       // from the constructor at line 6
}
</code></pre>
<p><br>
Results:</p>
<pre><code>Fst 12
Scd 12
</code></pre>
<p><br></p>
<p><em>Contribution:</em> Redirection to named constructor does not work for the moment. This is not complicated, but has to be done.</p>
<a class="header" href="objects/class.html#constructor-privacy" id="constructor-privacy"><h3>Constructor privacy</h3></a>
<p>As fields, the privacy of the constructor is protected by default. The
keyword <strong><code>prv</code></strong> and <strong><code>pub</code></strong> can be used to change it.</p>
<a class="header" href="objects/class.html#destructors" id="destructors"><h2>Destructors</h2></a>
<p>Object instances are destroyed by the garbage collector. Meaning that
there is no way to determine when or even if an object instance will
be destroyed. But lets say that such operation effectively happen
(which is quite probable, let's no lie either), then a last function
can be called just before the object instance is destroyed and
irrecoverable. The destructor is called <strong><code>__dtor</code></strong>, and takes the
parameter <strong><code>mut self</code></strong>. There is only one destructor per class, this
destructor is optional and always public.</p>
<pre><code class="language-ymir">import std::io;

static mut I = 0;

class A {
    let _x : i32;
    pub self () with _x = I {
        I += 1;
    }
    
    __dtor (mut self) {
        println (&quot;Destroying me ! &quot;, self._x); 
    }

}

def foo () {
    let _ = A::new (); 
} // the object instance is irrecoverable at the end of the function

def main () {
    loop {
        foo ();
    }
}
</code></pre>
<p><br></p>
<p>Results:</p>
<pre><code>Destroying me ! 765
Destroying me ! 1022
Destroying me ! 764
Destroying me ! 1023
Destroying me ! 763
Destroying me ! 1024
Destroying me ! 762
Destroying me ! 1025
Destroying me ! 761
Destroying me ! 1026
...
</code></pre>
<p><br></p>
<p>One can note from the result, that the order of destruction is totally
unpredictible. Rely on class destructor is not the best practice. We
will see in a future chapter disposable objects, that are destroyed in
a more certain way. Destructors are a last resort to free unmanaged
memory, if this was forgotten (for example, file handles, network
socket, etc. if not manually disposed).</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="objects/README.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="objects/mutability.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="objects/README.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="objects/mutability.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        
    <script type="text/javascript">
        var socket = new WebSocket("ws://localhost:3001");
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload(true); // force reload from server (not from cache)
            }
        };

        window.onbeforeunload = function() {
            socket.close();
        }
    </script>


        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        
        <script type="text/javascript" src="custom.js"></script>
        

    </body>
</html>
