<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Alnomoj, Referencoj kaj pureco - Ymir Tour</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        
        <link rel="stylesheet" href="custom.css">
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="README.html"><strong>1.</strong> Antaŭparolo</a></li><li><a href="hello-world/README.html"><strong>2.</strong> Bonan tagon mondo</a></li><li><ul class="section"><li><a href="hello-world/commentaires.html"><strong>2.1.</strong> Komentoj</a></li></ul></li><li><a href="primitives/README.html"><strong>3.</strong> Bazaj konceptoj de programado</a></li><li><ul class="section"><li><a href="primitives/variables.html"><strong>3.1.</strong> Variabloj kaj Ŝanĝebleco</a></li><li><a href="primitives/types.html"><strong>3.2.</strong> Datenaj tipoj</a></li><li><a href="primitives/functions.html"><strong>3.3.</strong> Funkcioj</a></li><li><a href="primitives/control.html"><strong>3.4.</strong> Kontrolaj fluoj</a></li><li><a href="primitives/operator.html"><strong>3.5.</strong> Prioritato de operacioj</a></li></ul></li><li><a href="advanced/README.html" class="active"><strong>4.</strong> Alnomoj, Referencoj kaj pureco</a></li><li><ul class="section"><li><a href="advanced/references.html"><strong>4.1.</strong> Referencoj</a></li><li><a href="advanced/alias.html"><strong>4.2.</strong> Alnomoj</a></li><li><a href="advanced/copies.html"><strong>4.3.</strong> Kopio kaj profunda kopio</a></li><li><a href="advanced/best.html"><strong>4.4.</strong> Plej bonaj kutimoj</a></li><li><a href="advanced/pure.html"><strong>4.5.</strong> Puraj valoroj</a></li></ul></li><li><a href="modules/README.html"><strong>5.</strong> Pakaĵoj</a></li><li><a href="types/README.html"><strong>6.</strong> Tipoj difinitaj de la uzanto</a></li><li><ul class="section"><li><a href="types/struct.html"><strong>6.1.</strong> Strukturo</a></li><li><a href="types/enum.html"><strong>6.2.</strong> Enumeracio</a></li><li><a href="types/aka.html"><strong>6.3.</strong> Kaŝnomo</a></li></ul></li><li><a href="objects/README.html"><strong>7.</strong> Objektoj</a></li><li><ul class="section"><li><a href="objects/class.html"><strong>7.1.</strong> Klaso</a></li><li><a href="objects/mutability.html"><strong>7.2.</strong> Ŝanĝebleco</a></li><li><a href="objects/methods.html"><strong>7.3.</strong> Metodoj</a></li><li><a href="objects/inheritance.html"><strong>7.4.</strong> Heredeco</a></li><li><a href="objects/traits.html"><strong>7.5.</strong> Trajto</a></li><li><a href="objects/cast.html"><strong>7.6.</strong> Tipŝanĝo, kaj dinamikaj tipoj</a></li></ul></li><li><a href="functions/README.html"><strong>8.</strong> Funkcioj pli kompleksaj</a></li><li><a href="pattern/README.html"><strong>9.</strong> Skema kongruo</a></li><li><a href="errors/main.html"><strong>10.</strong> Traktado de Eraroj</a></li><li><ul class="section"><li><a href="errors/scope_guards.html"><strong>10.1.</strong> Regionaj gardantoj</a></li><li><a href="errors/catching.html"><strong>10.2.</strong> Kapti erarojn</a></li><li><a href="errors/option.html"><strong>10.3.</strong> Esceptoj kaj opcia tipo</a></li><li><a href="errors/fptr_closure.html"><strong>10.4.</strong> Montrilo de Malsekuraj Funkcioj</a></li></ul></li><li><a href="templates/README.html"><strong>11.</strong> Ŝablonoj</a></li><li><ul class="section"><li><a href="templates/special.html"><strong>11.1.</strong> Ŝablonaj tipoj</a></li><li><a href="templates/cte.html"><strong>11.2.</strong> Ŝablonaj valoroj</a></li><li><a href="templates/values.html"><strong>11.3.</strong> Plenumo dum kompilado</a></li></ul></li><li><a href="objects/common_traits.html"><strong>12.</strong> Ordinaraj trajtoj</a></li><li><ul class="section"><li><a href="traits/streamable.html"><strong>12.1.</strong> &quot;Streamable&quot;</a></li><li><a href="traits/copiable.html"><strong>12.2.</strong> &quot;Copiable&quot;</a></li><li><a href="traits/disposable.html"><strong>12.3.</strong> &quot;With&quot; gardanto kaj &quot;Disposable&quot;</a></li><li><a href="traits/hashable.html"><strong>12.4.</strong> &quot;Hashable&quot;</a></li><li><a href="traits/serialize.html"><strong>12.5.</strong> &quot;Packable&quot; kaj &quot;Serializable&quot;</a></li></ul></li><li><a href="templates/operators.html"><strong>13.</strong> Transŝargo de Operacisimboloj</a></li><li><ul class="section"><li><a href="templates/binary.html"><strong>13.1.</strong> Unuopaj, duopaj kaj komparaj operacioj</a></li><li><a href="templates/complex_operators.html"><strong>13.2.</strong> Aliraj, Enhavaj kaj iteraciaj operacioj</a></li></ul></li><li><a href="version/README.html"><strong>14.</strong> Versioj</a></li><li><a href="macros/README.html"><strong>15.</strong> Makrooj</a></li><li><ul class="section"><li><a href="macros/std.html"><strong>15.1.</strong> Normaj kaj kernaj makrooj</a></li></ul></li><li><a href="documentation/README.html"><strong>16.</strong> Dokumentaro</a></li><li><ul class="section"><li><a href="documentation/types.html"><strong>16.1.</strong> Tipoj</a></li><li><a href="documentation/symbols.html"><strong>16.2.</strong> Simboloj</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Ymir Tour</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="advanced/README.html#alias-and-references" id="alias-and-references"><h1>Alias and References</h1></a>
<p>The alias and reference is one of the most important characteristics
of the <em>Ymir</em> language, which allows it to give guarantees on the
mutability of the data, and the explicit movement of the memory. It is
important to understand how memory works in <em>Ymir</em>, in order to
understand the error message you might get when you try to move data
from one variable to another.</p>
<p><em>Ymir</em> is a high level programming language, thus there is no need to
worry about memory management (memory leaks), the language using a
garbage collector. However, in terms of mutability and access rights,
the language provides an expressive system for managing memory
movements.</p>
<a class="header" href="advanced/README.html#standard-and-aliasable-types" id="standard-and-aliasable-types"><h2>Standard and Aliasable types</h2></a>
<p>In <em>Ymir</em>, there are two types, standard types and aliasable
types. A value whose type is a standard type, can be copied without
the need of explicitly inform the compiler. The standard types are all
primitive scalar types. On the other hand, aliasable types are types
that have borrowed data, which will not be copied unless it is
explicitly written into the code, to avoid performance loss.</p>
<p>To understand how data is represented in a program, you need to know
the difference between heap and stack. The stack is a space allocated
by the program when a function is entered, which is released when the
function is exited. On the other hand, the heap is a space that is
allocated when certain instructions in the program require it, such as
allocating a new slice, allocating  a new object instance, and so on.</p>
<p>When a slice is allocated, all its data is stored in the heap, and the
address of this data is stored in the stack, where the variables are
located. The following figure shows the data representation for this
program:</p>
<pre><code class="language-ymir">def foo () {
    let x = [1, 2, 3];
}
</code></pre>
<p><br></p>
<p><img src="https://gnu-ymir.github.io/Documentations/en/advanced/memory_x_foo.png" alt="drawing" height="500" style="display: block; margin-left: auto;  margin-right: auto;"></p>
<a class="header" href="advanced/README.html#mutability-level" id="mutability-level"><h2>Mutability level</h2></a>
<p>We define the level of mutability as the deepest level of the type
that is mutable. An example of a mutability level is shown in the
following table:</p>
<table><thead><tr><th> Type </th><th> Level </th></tr></thead><tbody>
<tr><td> mut [i32] </td><td> 1 </td></tr>
<tr><td> [i32] </td><td> 0 </td></tr>
<tr><td> mut [mut i32] </td><td> 2 </td></tr>
<tr><td> dmut [[[i32]]] </td><td> 4 </td></tr>
</tbody></table>
<p>This is mainly used to ensure that the borrowed data is not changed by
another variable in a foreign part of the program. The users have full
control over the data they have created. The example below shows
how the mutability level is used to ensure that the content of a
table is never changed.</p>
<pre><code class="language-ymir">import std::io

def main () 
    throws &amp;OutOfArray
{
    let mut x = [1, 2, 3];
    x = [2, 3, 4];

    x [0] = 8;
}
</code></pre>
<p><br></p>
<p>The type of <strong><code>x</code></strong> in the above example is <strong><code>mut [i32]</code></strong>. The
mutability of the internal part of the slice (<strong><code>i32</code></strong> value) is not
specified. The compiler, for security reasons, infered it as
immutable. The line <strong>5</strong> of the previous example is accepted, because
the variable <strong><code>x</code></strong> is mutable, however, the value pointed by the
slice contained in <strong><code>x</code></strong> is not. For that reason the line <strong>9</strong> is
not accepted and the compiler returns the following error.</p>
<pre><code class="language-error">Error : left operand of type i32 is immutable
 --&gt; main.yr:(7,7)
 7  ┃     x [0] = 8;
    ╋       ^


ymir1: fatal error: 
compilation terminated.
</code></pre>
<p><br></p>
<p>If the mutability level defines the write permission of every data, it
is assumed that every parts of the code that have access to a give
value have read permission on it. For that reason, in the previous
example, even if writting into <strong><code>x [0]</code></strong> is not permitted, reading
its value is allowed.</p>
<a class="header" href="advanced/README.html#deep-mutability" id="deep-mutability"><h3>Deep mutability</h3></a>
<p>Earlier we introduced the keyword <strong><code>dmut</code></strong>, this keyword is used to
avoid a very verbose type statement, and defines that every subtype
are mutable. This keyword is applicable to all types, but will only
have a different effect from the <strong><code>mut</code></strong> decorator on aliasable
types. The following table gives an example of an slice type, using
the keyword <code>dmut</code> :</p>
<table><thead><tr><th> Type </th><th> Verbose equivalent </th></tr></thead><tbody>
<tr><td> dmut [i32] </td><td> mut [mut i32] </td></tr>
<tr><td> dmut [[[i32]]] </td><td> mut [mut [mut [mut i32]]] </td></tr>
</tbody></table>
<p>If we come back to our previous example, and change the type of the
variable <strong><code>x</code></strong>, and use the keyword <strong><code>dmut</code></strong>. The variable <strong><code>x</code></strong>
now borrows mutable datas, that can be modified, thus the expression
at line <strong>9</strong> is accepted.</p>
<pre><code class="language-ymir">import std::io

def main () 
    throws &amp;OutOfArray
{
    let dmut x = [1, 2, 3];
    x = [2, 3, 4];
    
    x [0] = 8;
}
</code></pre>
<a class="header" href="advanced/README.html#const-keyword" id="const-keyword"><h3>Const keyword</h3></a>
<p>The <strong><code>const</code></strong> keyword is the perfect opposite of the <strong><code>dmut</code></strong>
keyword. This keyword has no interest when defining types directly
(because they are immutable by default), but coupled with the keyword
<strong><code>typeof</code></strong>, it can transform a mutable type into a immutable type.</p>
<pre><code class="language-ymir">import std::io;

def main () {
    let mut x = 12;
    println (typeof (x)::typeid);
    println ((const typeof (x))::typeid);
}
</code></pre>
<p>Results:</p>
<pre><code>mut i32
i32
</code></pre>
<a class="header" href="advanced/README.html#string-literal" id="string-literal"><h3>String literal</h3></a>
<p>Strings literal, unlike slice literals, are in the text segment of the
program (read-only part of a program). This means that the type of a
literal string is <strong><code>[c32]</code></strong> (or <strong><code>[c8]</code></strong> if the suffix <code>s8</code> is
specified), while the type of a literal array (of <code>i32</code> for example)
is <strong><code>mut [mut i32]</code></strong>. For that reason, it impossible to borrow the
data into a deeply mutable variable.</p>
<pre><code class="language-ymir">import std::io

def main () {
    let dmut x = &quot;Try to make me mutable !?&quot;;
}
</code></pre>
<p><br></p>
<p>The compiler returns an error. This error means that the mutability
level of the right operand is <strong>1</strong>, here <code>mut [c32]</code>, (the reference
of the array is mutable but not its content), and the code try to put
the reference inside a variable of mutability level <strong>2</strong>, that is to
say of type <code>mut [mut c32]</code>. If this was allowed the variable <code>x</code>
would have the possibility to change data that has been marked as
immutable at some point of the program, so the compiler does not allow
it, and returns the following error.</p>
<pre><code class="language-error">Error : discard the constant qualifier is prohibited, left operand mutability level is 2 but must be at most 1
 --&gt; main.yr:(4,11)
 4  ┃ 	let dmut x = &quot;Try to make me mutable !?&quot;;
    ╋ 	         ^
    ┃ Note : 
    ┃  --&gt; main.yr:(4,15)
    ┃  4  ┃ 	let dmut x = &quot;Try to make me mutable !?&quot;;
    ┃     ╋ 	             ^
    ┗━━━━━┻━ 


ymir1: fatal error: 
compilation terminated.
</code></pre>
<p><br></p>
<a class="header" href="advanced/README.html#memory-borrowing" id="memory-borrowing"><h2>Memory borrowing</h2></a>
<p>When you want to make a copy of a value whose type is aliasable, you
must tell the compiler how you want to make the copy. There are four
ways to move or reference memory, which are provided with the four
keywords <code>ref</code>, <code>alias</code>, <code>copy</code> and <code>dcopy</code>. The following chapters
presents these keywords, and the semantic associated to them.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="primitives/operator.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="advanced/references.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="primitives/operator.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="advanced/references.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        
    <script type="text/javascript">
        var socket = new WebSocket("ws://localhost:3001");
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload(true); // force reload from server (not from cache)
            }
        };

        window.onbeforeunload = function() {
            socket.close();
        }
    </script>


        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        
        <script type="text/javascript" src="custom.js"></script>
        

    </body>
</html>
