
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Function advanced Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/code.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-spoiler/spoiler.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-nav-x/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../pattern/" />
    
    
    <link rel="prev" href="../objects/cast.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../hello-world/">
            
                <a href="../hello-world/">
            
                    
                    Hello World
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../hello-world/commentaires.html">
            
                <a href="../hello-world/commentaires.html">
            
                    
                    Comments
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../primitives/">
            
                <a href="../primitives/">
            
                    
                    Basic programming concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../primitives/variables.html">
            
                <a href="../primitives/variables.html">
            
                    
                    Variable and Mutability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../primitives/types.html">
            
                <a href="../primitives/types.html">
            
                    
                    Data types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../primitives/functions.html">
            
                <a href="../primitives/functions.html">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../primitives/control.html">
            
                <a href="../primitives/control.html">
            
                    
                    Control flows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../primitives/operator.html">
            
                <a href="../primitives/operator.html">
            
                    
                    Operator priority
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../advanced/">
            
                <a href="../advanced/">
            
                    
                    Alias and References
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../advanced/references.html">
            
                <a href="../advanced/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../advanced/alias.html">
            
                <a href="../advanced/alias.html">
            
                    
                    Aliases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../advanced/copies.html">
            
                <a href="../advanced/copies.html">
            
                    
                    Copy and Deep copy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../advanced/best.html">
            
                <a href="../advanced/best.html">
            
                    
                    Best practice
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../modules/">
            
                <a href="../modules/">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../types/">
            
                <a href="../types/">
            
                    
                    User defined types
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../types/struct.html">
            
                <a href="../types/struct.html">
            
                    
                    Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../types/enum.html">
            
                <a href="../types/enum.html">
            
                    
                    Enum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../types/aka.html">
            
                <a href="../types/aka.html">
            
                    
                    Aka
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../objects/">
            
                <a href="../objects/">
            
                    
                    Objects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../objects/class.html">
            
                <a href="../objects/class.html">
            
                    
                    Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../objects/mutability.html">
            
                <a href="../objects/mutability.html">
            
                    
                    Mutability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../objects/methods.html">
            
                <a href="../objects/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../objects/inheritance.html">
            
                <a href="../objects/inheritance.html">
            
                    
                    Inheritance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../objects/traits.html">
            
                <a href="../objects/traits.html">
            
                    
                    Traits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../objects/cast.html">
            
                <a href="../objects/cast.html">
            
                    
                    Cast, and dynamic typing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.8" data-path="./">
            
                <a href="./">
            
                    
                    Function advanced
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../pattern/">
            
                <a href="../pattern/">
            
                    
                    Pattern matching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../errors/main.html">
            
                <a href="../errors/main.html">
            
                    
                    Error handling
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../errors/scope_guards.html">
            
                <a href="../errors/scope_guards.html">
            
                    
                    Scope guards
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../errors/catching.html">
            
                <a href="../errors/catching.html">
            
                    
                    Catching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../errors/option.html">
            
                <a href="../errors/option.html">
            
                    
                    Exception and option type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../errors/fptr_closure.html">
            
                <a href="../errors/fptr_closure.html">
            
                    
                    Unsafe function pointer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../templates/">
            
                <a href="../templates/">
            
                    
                    Templates
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../templates/special.html">
            
                <a href="../templates/special.html">
            
                    
                    Template types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../templates/cte.html">
            
                <a href="../templates/cte.html">
            
                    
                    Template values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../templates/values.html">
            
                <a href="../templates/values.html">
            
                    
                    Compilation time execution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../objects/common_traits.html">
            
                <a href="../objects/common_traits.html">
            
                    
                    Common traits
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../traits/streamable.html">
            
                <a href="../traits/streamable.html">
            
                    
                    Streamable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../traits/copiable.html">
            
                <a href="../traits/copiable.html">
            
                    
                    Copiable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../traits/disposable.html">
            
                <a href="../traits/disposable.html">
            
                    
                    With guard and Disposable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../traits/hashable.html">
            
                <a href="../traits/hashable.html">
            
                    
                    Hashable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../traits/serialize.html">
            
                <a href="../traits/serialize.html">
            
                    
                    Packable and Serializable
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../templates/operators.html">
            
                <a href="../templates/operators.html">
            
                    
                    Operator overloading
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../templates/binary.html">
            
                <a href="../templates/binary.html">
            
                    
                    Unary, binary and Comparison
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../templates/complex_operators.html">
            
                <a href="../templates/complex_operators.html">
            
                    
                    Access, contains and iteration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../version/">
            
                <a href="../version/">
            
                    
                    Version
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../macros/">
            
                <a href="../macros/">
            
                    
                    Macro
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../macros/std.html">
            
                <a href="../macros/std.html">
            
                    
                    Std and Core macros
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../documentation/">
            
                <a href="../documentation/">
            
                    
                    Documentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../documentation/types.html">
            
                <a href="../documentation/types.html">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../documentation/symbols.html">
            
                <a href="../documentation/symbols.html">
            
                    
                    Symbols
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Function advanced</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-minus-circle"></i><ul><li><span class="title-icon "></span><a href="#functions"><b>1. </b>Functions</a></li><ul><li><span class="title-icon "></span><a href="#function-pointer"><b>1.1. </b>Function pointer</a></li><ul><li><span class="title-icon "></span><a href="#function-pointer-using-reference"><b>1.1.1. </b>Function pointer using reference</a></li></ul><li><span class="title-icon "></span><a href="#lambda-function"><b>1.2. </b>Lambda function</a></li><li><span class="title-icon "></span><a href="#closure"><b>1.3. </b>Closure</a></li><ul><li><span class="title-icon "></span><a href="#copy-closure"><b>1.3.1. </b>Copy closure</a></li><li><span class="title-icon "></span><a href="#method-delegate"><b>1.3.2. </b>Method delegate</a></li><li><span class="title-icon "></span><a href="#polymorphic-delegate"><b>1.3.3. </b>Polymorphic delegate</a></li></ul></ul></ul></div><a href="#functions" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="functions"><a name="functions" class="anchor-navigation-ex-anchor" href="#functions"><i class="fa fa-link" aria-hidden="true"></i></a>1. Functions</h1>
<p>We have seen in the chapter <a href="https://gnu-ymir.github.io/Documentations/en/primitives/functions.html" target="_blank">Basic programming
concepts</a>
how functions are written. <em>Ymir</em> can be used as a functional
language, thus functions can also be considered as values. In this
chapter we will see more advanced function systems, named function
pointer and closure.</p>
<h2 id="function-pointer"><a name="function-pointer" class="anchor-navigation-ex-anchor" href="#function-pointer"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. Function pointer</h2>
<p>A function pointer is a value that contains a function. It can be used
for example, to pass a function, as an argument to other
functions. The type of a function pointer is written using the keyword
<strong><code>fn</code></strong>, and have nearly the same syntax as a function prototype, but
without a name, and without naming the parameters.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span>f <span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token function">f</span> <span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">addOne</span> <span class="token punctuation">(</span>x <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span>
    x <span class="token operator">+</span> <span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>addOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>In the above example, we have specified that the function <strong><code>foo</code></strong>
takes a function pointer as first parameter. This function pointer, is
a function that takes an <strong><code>i32</code></strong> value and return another <strong><code>i32</code></strong> value.
In the main function, the ampersand (<strong><code>&amp;</code></strong>) unary operator is used
to transform the function symbol <strong><code>addOne</code></strong> into a function
pointer. This function pointer is then passed to the function
<strong><code>foo</code></strong>, which calls it and return its value. </p>
<p>Results: </p>
<pre class="language-"><code>42
</code></pre><h3 id="function-pointer-using-reference"><a name="function-pointer-using-reference" class="anchor-navigation-ex-anchor" href="#function-pointer-using-reference"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1. Function pointer using reference</h3>
<p>We have seen that references is not a type, in the chapter <a href="https://gnu-ymir.github.io/Documentations/en/advanced/references.html" target="_blank">Alias and
References</a>. However,
function prototype sometimes takes reference value as parameter. This
must be replicated in the prototype of the function pointer. For that
reason, the <strong><code>ref</code></strong> keyword can be used in the prototype of a
function pointer type. </p>
<p>In the following example, the function <strong><code>mutAddOne</code></strong> change the
value of a reference variable <strong><code>x</code></strong>, and add one to it. The function
<strong><code>foo</code></strong> takes a function pointer as first parameter, and calls it on
a mutable local variable <strong><code>x</code></strong> by reference (it is important). </p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span>f <span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token other-keyword">ref</span> <span class="token other-keyword">mut</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> void<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> x <span class="token operator">=</span> <span class="token number">41</span><span class="token punctuation">;</span>
    <span class="token function">f</span> <span class="token punctuation">(</span><span class="token other-keyword">ref</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">mutAddOne</span> <span class="token punctuation">(</span><span class="token other-keyword">ref</span> <span class="token other-keyword">mut</span> x <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutAddOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Results: </p>
<pre class="language-"><code>42
</code></pre><p><br></p>
<p>The prototype of the function pointer must be strictly respected, for
obvious reasons. And as for normal functions, alias and references
must be strictly respected as well. For example, in the follow
example, the function <strong><code>foo</code></strong> tries to call the function pointer
that takes a reference argument, using a simple value. And the
<strong><code>main</code></strong> function tries to call the <strong><code>foo</code></strong> function, with a
function pointer that does not take a reference parameter.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span>f <span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token other-keyword">ref</span> <span class="token other-keyword">mut</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> void<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> x <span class="token operator">=</span> <span class="token number">41</span><span class="token punctuation">;</span>
    <span class="token function">f</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">mutAddOne</span> <span class="token punctuation">(</span>x <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutAddOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>We have two errors, first the compiler does not allow an implicit
referencing of the variable <strong><code>x</code></strong> at line <strong><code>5</code></strong>, and second the
compiler does not allow an implicit cast of a value of type <strong><code>fn
(i32)-&gt; void</code></strong> to <strong><code>fn (ref mut i32)-&gt; void</code></strong>.</p>
<pre class="language-"><code class="lang-error"><span class="token path">Error</span> : the call operator is not defined for &amp;fn(ref mut i32)-&gt; void and {mut i32}
 <span class="token comment">--&gt; main.yr:(5,7)</span>
 5  &#x2503;     f (x);
    &#x254B;       ^ ^
    &#x2503; <span class="token path">Error</span> : implicit referencing of type mut i32 is not allowed
    &#x2503;  <span class="token comment">--&gt; main.yr:(5,8)</span>
    &#x2503;  5  &#x2503;     f (x);
    &#x2503;     &#x254B;        ^
    &#x2503; <span class="token other-keyword">Note</span> : for parameter i32 <span class="token comment">--&gt; main.yr:(3,26) of f</span>
    &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501; 

<span class="token path">Error</span> : the call operator is not defined for main::foo and {&amp;fn(i32)-&gt; void}
 <span class="token comment">--&gt; main.yr:(14,17)</span>
14  &#x2503;     let x = foo (&amp;mutAddOne);
    &#x254B;                 ^          ^
    &#x2503; <span class="token other-keyword">Note</span> : candidate foo <span class="token comment">--&gt; main.yr:(3,5) : main::foo (f : &amp;fn(ref mut i32)-&gt; void)-&gt; i32</span>
    &#x2503;     &#x2503; <span class="token path">Error</span> : incompatible types &amp;fn(ref mut i32)-&gt; void and &amp;fn(i32)-&gt; void
    &#x2503;     &#x2503;  <span class="token comment">--&gt; main.yr:(14,18)</span>
    &#x2503;     &#x2503; 14  &#x2503;     let x = foo (&amp;mutAddOne);
    &#x2503;     &#x2503;     &#x254B;                  ^
    &#x2503;     &#x2503; <span class="token other-keyword">Note</span> : for parameter f <span class="token comment">--&gt; main.yr:(3,10) of main::foo (f : &amp;fn(ref mut i32)-&gt; void)-&gt; i32</span>
    &#x2503;     &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501; 
    &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x253B;&#x2501; 

<span class="token path">Error</span> : undefined symbol x
 <span class="token comment">--&gt; main.yr:(15,14)</span>
15  &#x2503;     println (x);
    &#x254B;              ^


ymir1: <span class="token path">fatal error</span>: 
compilation terminated.
</code></pre>
<h2 id="lambda-function"><a name="lambda-function" class="anchor-navigation-ex-anchor" href="#lambda-function"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Lambda function</h2>
<p>Lambda functions are anonymous functions that have the same behavior
as normal function, but don&apos;t have a name. They are declared using the
token <code>|</code> surrounding the parameters instead of parentheses in order
to dinstinguish them from tuple. The following code block presents the
syntax of the lambda functions.</p>
<pre class="language-"><code class="lang-grammar"><span class="token path">lambda_func</span> <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&apos;|&apos;</span> <span class="token punctuation">(</span>var_decl <span class="token punctuation">(</span><span class="token string">&apos;,&apos;</span> var_decl<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">)</span>? <span class="token string">&apos;|&apos;</span> <span class="token punctuation">(</span><span class="token string">&apos;-&gt;&apos;</span> type<span class="token punctuation">)</span>? <span class="token punctuation">(</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">)</span>? expression
<span class="token path">var_decl</span> <span class="token punctuation">:</span><span class="token operator">=</span> Identifier <span class="token punctuation">(</span><span class="token string">&apos;:&apos;</span> type<span class="token punctuation">)</span>?
</code></pre>
<p><br></p>
<p>The following example shows a simple usage of a lambda function. This
function declared at line <strong><code>4</code></strong>, and stored in the variable <strong><code>x</code></strong>,
takes two parameters <strong><code>x</code></strong> and <strong><code>y</code></strong> of type <strong><code>i32</code></strong>, and return
their sum.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">|</span>x <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">,</span> y <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token operator">|</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span> 
        x <span class="token operator">+</span> y
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>As one can note, there is no conflict between the variable <strong><code>x</code></strong>
declared in the function <strong><code>main</code></strong>, and the first parameter of the
lambda function also named <strong><code>x</code></strong>. This is due to the fact that the
lambda function does not enclose the context of the function that have
created it. In other words, lambda functions behave as normal local
function, accessible only inside the function that have declared them
(<em>cf.</em>  <a href="https://gnu-ymir.github.io/Documentations/en/primitives/functions.html#scope-declaration" target="_blank">Scope
declaration</a>).</p>
<p>In many cases the type of the parameters and return type can be
infered, and are therefore optional. The above example can then be
rewritten into the following example. In this next example, the lambda
function can be called with any values, as long as the binary addition
(<strong><code>+</code></strong>) operator is defined between the two values.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token punctuation">,</span> y<span class="token operator">|</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>    
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// The types are not given, then you can also write </span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">2.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>The token <code>=&gt;</code> can be added after the prototype of the lambda, to make
it a bit more readable. It is just syntaxic and has no impact on the
behavior of the lambda.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token punctuation">,</span> y<span class="token operator">|</span> <span class="token operator">=</span><span class="token operator">&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>    
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Lambda functions are directly function pointers, and then can be used
as such without needing the unary ampersand (<strong><code>&amp;</code></strong>) operator. In the
following example, the function <strong><code>foo</code></strong> takes a function pointer as
first parameter, and two <strong><code>i32</code></strong> values as second and third
parameters. This function calls the function pointer twice, and add
the result. A lambda function is used in the <strong><code>main</code></strong> function as
the first argument for the <strong><code>foo</code></strong> function.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span>f <span class="token punctuation">:</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token basic-types">i32</span><span class="token punctuation">,</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span><span class="token punctuation">,</span> x <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">,</span> y <span class="token punctuation">:</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token function">f</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">f</span> <span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token punctuation">,</span> y<span class="token operator">|=</span><span class="token operator">&gt;</span> x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// uniform call syntax is used, but you can of course write it as follows : </span>
    <span class="token comment">// foo (|x, y| x*y, 3, 7);</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Results: </p>
<pre class="language-"><code>42
</code></pre><p><br></p>
<p>Lambda function that are not typed are special element, that does not
really have a value at runtime, and are closer to <em>compile time
values</em> (presented in a future chapter <a href="https://gnu-ymir.github.io/Documentations/en/templates/cte.html" target="_blank">Compile time
execution</a>).
When the whole type of a lambda cannot be infered by the compiler
(types of the parameters, and the type of the return type), then the
value cannot be passed to a mutable variable. <em>Ymir</em> allows to put an
untyped lambda inside an immutable var, to ease its usage, but the
lambda still does not have any value. For that reason, the second line
of the following example is possible, but not the third.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br>
Errors: </p>
<pre class="language-"><code class="lang-error"><span class="token path">Error</span> : the type mut fn (any)-&gt; any is not complete
 <span class="token comment">--&gt; main.yr:(2,10)</span>
 2  &#x2503;     let x = |x| x + 1;
    &#x254B;             ^
    &#x2503; <span class="token other-keyword">Note</span> : 
    &#x2503;  <span class="token comment">--&gt; main.yr:(3,10)</span>
    &#x2503;  3  &#x2503;     let mut y = x;
    &#x2503;     &#x254B;             ^
    &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x253B;&#x2501; 


ymir1: <span class="token path">fatal error</span>: 
compilation terminated.
</code></pre>
<p><br></p>
<p>The same problem happens when an uncomplete lambda function is used as
the value of a function. To resolve the problem, and because the
return type of a function is always complete when the function is
validated (or there were other previous errors), the keyword
<strong><code>return</code></strong> can be used. Thanks to that statement, the compiler has
additional knowledge, and can infer the type of the lambda function
from the return type of the function.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">|</span>x<span class="token operator">|</span> <span class="token operator">=</span><span class="token operator">&gt;</span> x <span class="token operator">+</span> <span class="token number">12</span> <span class="token comment">// the compiler tries to transform the lambda function into a function pointer fn (i32)-&gt; i32</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p><strong>Contribution</strong>: Resolve that problem when it seems obvious, for
example in the previous example, maybe the type of the block can be
infered directly?</p>
<h2 id="closure"><a name="closure" class="anchor-navigation-ex-anchor" href="#closure"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Closure</h2>
<p>As said earlier, a lambda function behave like a local private
function, and thus has no access to the context of the function that
have declared it. In the following example, the lambda function
declared at line <strong><code>5</code></strong> tries to access the variable <strong><code>i</code></strong> declared
at line <strong><code>4</code></strong>. This is impossible, the variable <strong><code>i</code></strong> exists in a
different context that the lambda function.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">{</span>
        <span class="token function">println</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br>
Errors:</p>
<pre class="language-"><code>Error : undefined symbol i
 --&gt; main.yr:(6,12)
 6  &#x2503;         println (i);
    &#x254B;                  ^

Error : undefined symbol x
 --&gt; main.yr:(8,2)
 8  &#x2503;     x ();
    &#x254B;     ^


ymir1: fatal error: 
compilation terminated.
</code></pre><p><br></p>
<p>Closure are a function pointer that capture the environment of the
function that has declared them. In <em>Ymir</em> there is only one kind of
accepted closure, that is called the move closure.</p>
<h3 id="copy-closure"><a name="copy-closure" class="anchor-navigation-ex-anchor" href="#copy-closure"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.1. Copy closure</h3>
<p>A copy closure is a special kind of lambda function, that is declared
by using the keyword <strong><code>move</code></strong> in front of a lambda literal. The
closure as an immutable access to all the variable declared inside the
scope of the parent function. This closure is called a <em>copy closure</em>
because the access of the variable is made by copy (a first level copy
<em>cf.</em> <a href="https://gnu-ymir.github.io/Documentations/en/advanced/copies.html" target="_blank">Copy and Deep
copy</a>).
Because closure captures a context in addition to a function pointer,
the simple function pointer type is no more sufficient, and a new type
is introduced. The syntax of the closure type is created with the
keyword <strong><code>dg</code></strong> instead of <strong><code>fn</code></strong> (<em>dg</em> stands for delegate). A
delegate is a function pointer with an environment, and is the general
case of a closure (we will see in next section, a case of delegate
that are not closure).</p>
<p>In the following example, the <em>copy closure</em> declared at line <strong><code>9</code></strong>
enclosed the scope of the function <strong><code>foo</code></strong>, and thus has access to
the variable <strong><code>i</code></strong>. However, the enclosed variable is immutable (and
is a copy).</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span>

<span class="token keyword">def</span> <span class="token function">bar</span> <span class="token punctuation">(</span>f <span class="token punctuation">:</span> <span class="token keyword">dg</span> <span class="token punctuation">(</span><span class="token basic-types">i32</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token function">f</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token operator">|</span>x<span class="token operator">|=</span><span class="token operator">&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>The above source code in the context of the <strong><code>foo</code></strong> function, can be
illustrated by the following figure.</p>
<p><br></p>
<p><img src="https://gnu-ymir.github.io/Documentations/en/functions/closure.png" alt="drawing" height="500" ,="" style="display: block; margin-left: auto;  margin-right: auto;"></p>
<p><br></p>
<p>As one can note, the variable <strong><code>i</code></strong> enclosed in the closure is not
the same as the variable <strong><code>i</code></strong> of the <strong><code>main</code></strong> function. This has
two impact: </p>
<ul>
<li>a) <em>copy closure</em> can be returned safely from functions,
indeed even when the variable <strong><code>i</code></strong> does not exist anymore as the
function <strong><code>foo</code></strong> is exited, a copy of it is still accessible in the
heap (note that this is the same for aliasable types, that are in the
heap in any case). For example: </li>
</ul>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token keyword">dg</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> <span class="token basic-types">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token operator">||</span> <span class="token operator">=</span><span class="token operator">&gt;</span> i <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enclosed i does not exists, but thats not a problem</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Results:</p>
<pre class="language-"><code>42
</code></pre><p><br></p>
<ul>
<li>b) the value of the enclosed <strong><code>i</code></strong> is independant
from the value of the variable <strong><code>i</code></strong> in the <strong><code>foo</code></strong> function,
meaning that there is no way for the <strong><code>foo</code></strong> function to change the
value of the variable <strong><code>i</code></strong> inside the closure after its creation. For example : </li>
</ul>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> i <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">||</span> <span class="token operator">=</span><span class="token operator">&gt;</span> i <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">// no impact on the closure of x</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">||</span> <span class="token operator">=</span><span class="token operator">&gt;</span> i <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">y</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br>
Results: </p>
<pre class="language-"><code>42
23
</code></pre><p><br></p>
<p>By using aliasable types, this limitation can be bypassed, for example
a slice can be used to enclosed the value of i, and access it from the
closure, without removing the guarantees of the <em>copy closure</em>, this
is illustrated in the following example. <strong>Warning</strong>: if you might be
tempted to use a pointer on the <strong><code>i</code></strong> variable, its highly not
recommended. Indeed, pointing to a local variable remove the guarantee
we introduced earlier in the point (a) - (in general using pointer -
not function pointer - to value is a bad idea, and should be
prohibited outside the std).</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token operator">&amp;</span><span class="token type">OutOfArray</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">dmut</span> i <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">||</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">12</span>
    <span class="token punctuation">}</span> catch <span class="token punctuation">{</span>
        _ <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    i <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token function">println</span> <span class="token punctuation">(</span><span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>In the above example, the <em>copy closure</em> access to the first index of
the slice <strong><code>i</code></strong>. This is a unsafe operation, the slice can be empty,
this is why a catch is made. Information about catch is not presented
here, and will be discussed in a future chapter <a href="https://gnu-ymir.github.io/Documentations/en/errors/main.html" target="_blank">Error
handling</a>. Here
because the slice is not empty when the closure is called, the access
works.</p>
<p>Results: </p>
<pre class="language-"><code>42
</code></pre><h3 id="method-delegate"><a name="method-delegate" class="anchor-navigation-ex-anchor" href="#method-delegate"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.2. Method delegate</h3>
<p>A method is a function pointer associated with a object instance, then
they can be seen as delegate. The name closure is not used here,
because nothing is really enclosed as in <em>copy closure</em> over function
context, so the name <em>delegate</em> being a more global term is used. A
delegate is a function operating on an object, for which we don&apos;t know
the exact type. </p>
<p>A method can be transformed into a delegate using the unary ampersand
(<strong><code>&amp;</code></strong>) operator, on a method associated to an object instance. </p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> Foo <span class="token punctuation">{</span>
    <span class="token other-keyword">pub</span> <span class="token keyword">let</span> <span class="token other-keyword">mut</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> void <span class="token punctuation">{</span>
        <span class="token function">println</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">dmut</span> a <span class="token operator">=</span> <span class="token path">Foo</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token other-keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token other-keyword">dmut</span> b <span class="token operator">=</span> <span class="token path">Foo</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token other-keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">dg</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> void<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token type">a</span><span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token type">b</span><span class="token punctuation">.</span>foo<span class="token punctuation">;</span>

    a<span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

    <span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">y</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Results: </p>
<pre class="language-"><code>89
42
</code></pre><p><br></p>
<p>Unlike <em>copy closure</em> a method can have a mutable access to the object
associated to it. In that case, an explicit alias must be made on the
object instance, when creating the delegate, otherwise the compiler
throws an error. </p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> Foo <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> _i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token other-keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>_i <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token other-keyword">impl</span> Streamable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">dmut</span> a <span class="token operator">=</span> <span class="token path">Foo</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token other-keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">println</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
<p><br>
Errors:</p>
<pre class="language-"><code class="lang-error"><span class="token path">Error</span> : undefined operator &amp; for type (a).foo
 <span class="token comment">--&gt; main.yr:(18,13)</span>
18  &#x2503;     let x = &amp;(a.foo);
    &#x254B;             ^
    &#x2503; <span class="token other-keyword">Note</span> : candidate foo <span class="token comment">--&gt; main.yr:(8,13) : (mut self) =&gt; main::Foo::foo ()-&gt; void</span>
    &#x2503;     &#x2503; <span class="token path">Error</span> : discard the constant qualifier is prohibited, left operand mutability level is 2 but must be at most 1
    &#x2503;     &#x2503;  <span class="token comment">--&gt; main.yr:(18,13)</span>
    &#x2503;     &#x2503; 18  &#x2503;     let x = &amp;(a.foo);
    &#x2503;     &#x2503;     &#x254B;             ^
    &#x2503;     &#x2503;     &#x2503; <span class="token other-keyword">Note</span> : implicit alias of type mut &amp;(mut main::Foo) is not allowed, it will implicitly discard constant qualifier
    &#x2503;     &#x2503;     &#x2503;  <span class="token comment">--&gt; main.yr:(18,15)</span>
    &#x2503;     &#x2503;     &#x2503; 18  &#x2503;     let x = &amp;(a.foo);
    &#x2503;     &#x2503;     &#x2503;     &#x254B;               ^
    &#x2503;     &#x2503;     &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x253B;&#x2501; 
    &#x2503;     &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x253B;&#x2501; 
    &#x2517;&#x2501;&#x2501;&#x2501;&#x2501;&#x2501;&#x253B;&#x2501; 

<span class="token path">Error</span> : undefined symbol x
 <span class="token comment">--&gt; main.yr:(20,5)</span>
20  &#x2503;     x ();
    &#x254B;     ^


ymir1: <span class="token path">fatal error</span>: 
compilation terminated.
</code></pre>
<p><br></p>
<p>This can be easily resolved by aliasing the variable <strong><code>a</code></strong> when
creating the delegate. Either by using the keyword <strong><code>alias</code></strong>, or by
using the <strong><code>:.</code></strong> binary operator.</p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> Foo <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">mut</span> _i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token other-keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>_i <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token other-keyword">impl</span> Streamable<span class="token punctuation">;</span> <span class="token comment">// to make the type printable</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token other-keyword">dmut</span> a <span class="token operator">=</span> <span class="token path">Foo</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token other-keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or &amp;((alias a).foo);</span>

    <span class="token function">x</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">println</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Results:</p>
<pre class="language-"><code>main::Foo(42)
</code></pre><p><br></p>
<h3 id="polymorphic-delegate"><a name="polymorphic-delegate" class="anchor-navigation-ex-anchor" href="#polymorphic-delegate"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.3. Polymorphic delegate</h3>
<p>Method delegates respect the polyphormism introduced by class inheritance. </p>
<pre class="language-"><code class="lang-ymir"><span class="token keyword">import</span> <span class="token path">std</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token path">io</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> Foo <span class="token punctuation">{</span>
    <span class="token other-keyword">pub</span> <span class="token keyword">self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">def</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span> <span class="token punctuation">(</span><span class="token string">&quot;Bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Bar <span class="token keyword">over</span> Foo <span class="token punctuation">{</span>
    <span class="token other-keyword">pub</span> <span class="token keyword">self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token other-keyword">pub</span> <span class="token keyword">over</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span> <span class="token punctuation">(</span><span class="token string">&quot;Bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token punctuation">:</span> <span class="token type">&amp;Foo</span> <span class="token operator">=</span> <span class="token path">Bar</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token other-keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">d</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><br></p>
<p>Results:</p>
<pre class="language-"><code>Bar
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../objects/cast.html" class="navigation navigation-prev " aria-label="Previous page: Cast, and dynamic typing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../pattern/" class="navigation navigation-next " aria-label="Next page: Pattern matching">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Function advanced","level":"1.8","depth":1,"next":{"title":"Pattern matching","level":"1.9","depth":1,"path":"pattern/README.md","ref":"pattern/README.md","articles":[]},"previous":{"title":"Cast, and dynamic typing","level":"1.7.6","depth":2,"path":"objects/cast.md","ref":"objects/cast.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","katex","codeblock-filename","spoiler","folding-menu","language-picker","anchor-nav-x","code"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["themes/code.css"]},"spoiler":{},"language-picker":{"grid-columns":3},"search":{},"folding-menu":{"animationDuration":400,"sticky":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"isRewritePageTitle":false,"toolTipMode":"click"},"codeblock-filename":{},"anchor-nav-x":{"associatedWithSummary":true,"float":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showLevel":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"functions/README.md","mtime":"2021-06-17T06:30:48.366Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-07-29T15:21:12.835Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-spoiler/spoiler.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-folding-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchor-nav-x/lib/handler.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

